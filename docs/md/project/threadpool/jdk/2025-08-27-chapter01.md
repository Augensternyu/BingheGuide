---
title: 第01节：线程池核心原理技术解析
pay: https://articles.zsxq.com/id_es9ekcwm595m.html
---

# 《手写线程池》线程池核心技术：第01节：线程池核心原理技术解析

作者：冰河
<br/>星球：[http://m6z.cn/6aeFbs](http://m6z.cn/6aeFbs)
<br/>博客：[https://binghe.gitcode.host](https://binghe.gitcode.host)
<br/>文章汇总：[https://binghe.gitcode.host/md/all/all.html](https://binghe.gitcode.host/md/all/all.html)
<br/>源码获取地址：[https://t.zsxq.com/0dhvFs5oR](https://t.zsxq.com/0dhvFs5oR)

> 沉淀，成长，突破，帮助他人，成就自我。

* 本章难度：★★★☆☆
* 本章重点：简单介绍线程池的核心原理，重点掌握：线程池的核心状态、线程池的创建方式、执行任务的核心流程、线程池的关闭方式和如何确定最佳线程数等核心技术。从全局视角掌握线程池的核心技术原理，学会融汇贯通，将线程池的编程思想灵活应用到自身实际项目中，提升实际项目的并发处理能力，以及自身的并发编程内功功底。

**大家好，我是冰河~~**

使用线程池最大的好处就是能够实现线程的复用，不必每次执行任务时都重新创建线程。同时，线程池能够有效的控制最大并发线程数，防止无限制的创建线程导致系统宕机或OOM，能够提高系统资源的利用效率，同时能够有效的避免过度的资源竞争。

另外，线程池也提供了定时执行、定期执行、并发数控制等功能，也能够对线程池的资源进行实时监控。

## 一、前言

从本节开始，就正式进入《手写线程池》的线程池核心技术篇章。对于线程池的原理性技术来说，尤其是线程池的源码，学习起来是比较枯燥的，希望大家都能踏下心来，跟着冰河认真学。经过《手写线程池》专栏对线程池的深入剖析和我们自己从零开始手写一个线程池，我相信，只要小伙伴们认真学习，坚持下来后，一定会对线程池技术有一个全新的认识，并能够将线程池技术融会贯通，灵活应用到自身实际项目中。同时，也能在并发编程领域进一步突破自身的技术瓶颈。

## 二、本节诉求

简单介绍线程池的核心原理，重点掌握：线程池的核心状态、线程池的创建方式、执行任务的核心流程、线程池的关闭方式和如何确定最佳线程数等核心技术。从全局视角掌握线程池的核心技术原理，学会融汇贯通，将线程池的编程思想灵活应用到自身实际项目中，提升实际项目的并发处理能力，以及自身的并发编程内功功底。

## 三、线程池核心状态

线程池在运行的过程中，会通过定义的一些常量值来标注线程池的运行状态，接下来，就简单介绍下线程池在运行过程中的几个核心状态。

### 3.1 核心状态说明

在线程池的核心类ThreadPoolExecutor中，定义了几个关于线程池在运行过程中的核心状态。源码如下所示。

```java
private static final int COUNT_BITS = Integer.SIZE - 3;
private static final int CAPACITY   = (1 << COUNT_BITS) - 1;

// runState is stored in the high-order bits
private static final int RUNNING    = -1 << COUNT_BITS;
private static final int SHUTDOWN   =  0 << COUNT_BITS;
private static final int STOP       =  1 << COUNT_BITS;
private static final int TIDYING    =  2 << COUNT_BITS;
private static final int TERMINATED =  3 << COUNT_BITS;
```

从源码中可以看出，线程池在运行的过程中所涉及到的核心状态包括：RUNNING、SHUTDOWN、STOP、TIDYING、TERMINATED。各个状态的具体含义说明如下所示。

* RUNNING：表示线程池处于运行状态，此时线程池能够接收新提交过来的任务，并且也能够处理阻塞队列中的任务。

* SHUTDOWN：表示线程池处于关闭状态，此时线程池不能再接收新提交过来的任务，但是不会中断正在执行任务的线程，能够继续执行正在执行的任务，也能够处理阻塞队列中已经保存的任务。如果线程池处于RUNNING状态时，调用线程池的shutdown()方法会使线程池进入SHUTDOWN状态。

* STOP：表示线程池处于停止状态，此时线程池不能再接收新提交过来的任务，也不能继续处理阻塞队列中的任务，同时，还会中断正在执行任务的线程，使得正在执行的任务被中断。如果线程池处于RUNNING状态或者SHUTDOWN状态，调用线程池的shutdownNow()方法会使线程池进入STOP状态。

* TIDYING：如果线程池中所有的任务都已经终止，有效线程数为0，线程池就会进入TIDYING状态。换句话说，线程池中已经没有正在执行的任务，并且线程池中的阻塞队列为空，同时线程池中的工作线程数量为0，此时，线程池就会进入TIDYING状态。

* TERMINATED：如果线程池处于TIDYING状态，此时调用线程池的terminated()方法，线程池就会进入TERMINATED状态。

### 3.2 核心状态的流转过程

线程池在运行的过程中，其内部维护的状态变量的值不是一成不变的，而是会随着某些事件的触发而动态变化，线程池核心状态的流转过程如图1-1所示。

<div align="center">
    <img src="https://binghe.gitcode.host/images/project/threadpool/2025-08-27-001.png?raw=true" width="70%">
    <br/>
</div>

线程池由RUNNING状态转换成TERMINATED状态需要经过如下流程。

（1）当线程池处于RUNNING状态时，显示调用线程池的shutdown()方法，或者隐式调用finalize()方法，线程池会由RUNNING状态转换为SHUTDOWN状态。

（2）当线程池处于RUNNING状态时，显示调用线程池的shutdownNow()方法，线程池会由RUNNING状态转换为STOP状态。

（3）当线程池处于SHUTDOWN状态时，显示调用线程池的shutdownNow()方法，线程池会由SHUTDOWN状态转换为STOP状态。

（4）当线程池处于SHUTDOWN状态时，如果线程池中无工作线程，并且阻塞队列为空，则线程池会由SHUTDOWN状态转换为TIDYING状态。

（5）当线程池处于STOP状态时，如果线程池中无工作线程，则线程池会由STOP状态转换为TIDYING状态。

（6）当线程池处于TIDYING状态时，调用线程池的terminated()方法，线程池会由TIDYING状态转换为TERMINATED状态。

## 四、线程池的创建方式

## 查看完整文章

加入[冰河技术](https://public.zsxq.com/groups/48848484411888.html)知识星球，解锁完整技术文章、小册、视频与完整代码